{
  "title": "H2 database lock race at startup causes oracle text lookup failures",
  "description": "When multiple headless clients start simultaneously, they race to initialize the H2 card database via CardScanner.scan(). The second client hits an H2 lock error: 'Error opening database: Lock file recently modified'. While the error is non-fatal (the client recovers), it leaves the card database in an incomplete state, causing get_oracle_text to fail for many valid cards.\n\nIn game_20260210_234529:\n- Gem25F Analyst and Gem3F ESPN both logged H2 lock errors at startup (pilot.log lines 11-44)\n- get_oracle_text subsequently failed for Fain the Broker, Bloodthirsty Blade, Gideon Champion of Justice, Neverwinter Hydra, and others\n- Models couldn't look up card rules, leading to blind decisions\n\nEvidence:\n- ~/mage-bench-logs/game_20260210_234529/Gem25F Analyst_pilot.log: lines 11-44 (H2 lock error)\n- ~/mage-bench-logs/game_20260210_234529/Gem3F ESPN_pilot.log: lines 11-44 (H2 lock error)\n- ~/mage-bench-logs/game_20260210_234529/Sonnet Valley_pilot.log: lines 239, 288, 320 (oracle text failures)\n- ~/mage-bench-logs/game_20260210_234529/Haiku Gramps_pilot.log: line 202 (oracle text failure)\n\nSource: HeadlessClient.java:96 â€” CardScanner.scan() called without cross-process synchronization. Each client creates its own JdbcConnectionSource to the same H2 file (CardRepository.java:57-78).\n\nSuggested fix: Either (a) use H2's AUTO_SERVER=TRUE mode so multiple connections share a single server, (b) add a file lock to serialize scan() calls, or (c) have a shared pre-built database that clients read but don't write.",
  "status": "open",
  "priority": 3,
  "type": "bug",
  "labels": ["headless-client"],
  "created_at": "2026-02-11T00:30:00.000000-08:00",
  "updated_at": "2026-02-11T00:30:00.000000-08:00"
}
