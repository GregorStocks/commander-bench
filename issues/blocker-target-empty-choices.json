{
  "title": "GAME_TARGET returns empty choices for blocker-to-attacker assignment",
  "description": "When a player selects a creature to block with (via GAME_SELECT), XMage sends a GAME_TARGET \"Select attacker to block\" for the player to choose which attacker that blocker should block. The `findValidTargets()` method (BridgeCallbackHandler.java:2861) returns null/empty for this message type — `message.getTargets()`, `options.possibleTargets`, and `cardsView1` are all empty despite attackers being present.\n\nThe LLM sees `choices: []` with `required: false, can_cancel: true` and gets trapped: it can't pick an attacker (no choices), so it calls `get_action_choices` repeatedly getting the same empty list. If it cancels with `answer: false`, it deselects the blocker but immediately re-selects it and re-enters the trap. This loop persists until the stall detector or loop detector fires, resulting in all attackers going unblocked.\n\nEvidence:\n- ~/mage-bench-logs/game_20260211_002821/Gem3F Libby_pilot.log: 857 occurrences of \"Select attacker to block\" message (01:08:18 to 01:24:58)\n- ~/mage-bench-logs/game_20260211_002821/Gem3F Libby_llm.jsonl seq ~4701: get_action_choices returns `{\"action_type\":\"GAME_TARGET\", \"message\":\"Select attacker to block\", \"choices\":[], \"can_cancel\":true, \"required\":false}`\n- 16+ minutes wasted in the loop; Libby took 14 unblocked combat damage (17 -> 3 life)\n\nSource: BridgeCallbackHandler.java:2861 `findValidTargets()` — the three sources it checks (message.getTargets(), options.possibleTargets, cardsView1) don't contain the attacking creatures for this specific GAME_TARGET subtype.\n\nSuggested fix: In the GAME_TARGET case of getActionChoices() (line 930), detect the blocker-assignment case (message contains \"Select attacker to block\" or similar) and populate choices from `gameView.getCombat()` attacker lists, similar to how declare_blockers already extracts `incoming_attackers` in the GAME_SELECT handler (lines 808-823). Alternatively, teach `findValidTargets` to check combat groups for attackers when the message indicates blocker assignment.",
  "status": "open",
  "priority": 1,
  "type": "bug",
  "labels": ["headless-client"],
  "created_at": "2026-02-11T07:53:00.000000-08:00",
  "updated_at": "2026-02-11T07:53:00.000000-08:00"
}
