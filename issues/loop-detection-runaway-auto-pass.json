{
  "title": "Loop detection auto-pass skips turn-change reset, permanently disabling the player",
  "description": "When interactionsThisTurn exceeds maxInteractionsPerTurn (25), the loop detection in passPriority() calls executeDefaultAction() then `continue` (line 1568). This skips the turn-change detection at lines 1597-1608 where interactionsThisTurn is reset to 0. As a result, the counter never resets even as new turns begin, and the player is permanently auto-passed for the rest of the game.\n\nEvidence from ~/mage-bench-logs/game_20260210_074307/:\n- Gem3Flash_pilot.log line 1001+: Loop triggers on turn 79 with 26 interactions. All subsequent warnings still say 'turn 79' even as game events show turns 80-140+ advancing. Gem3Flash (the winning player with 37 life and creatures on board) auto-passes ~60 turns without playing a land, casting a spell, or attacking.\n- Devstral_pilot.log: 334 'Loop detected' warnings all stuck on 'turn 21'\n- GPT-4.1-mini was separately stalled (bug #choose-action-empty-target-list), so both remaining players did nothing for 3+ minutes while 60 turns cycled past.\n\nRoot cause: SkeletonCallbackHandler.java:1563-1568 â€” the `continue` on line 1568 jumps back to the top of the while loop (line 1557), skipping the GAME_SELECT handler (lines 1597-1610) where `lastTurnNumber` is compared to the current turn and `interactionsThisTurn` is reset. The counter stays permanently elevated.\n\nSuggested fix: Move the turn-change detection (lines 1597-1610) ABOVE the loop detection check (line 1563), or extract it into the loop detection branch so it runs before calling executeDefaultAction(). The key requirement is that when a GAME_SELECT arrives with a new turn number, interactionsThisTurn must be reset regardless of whether we're in loop-detected state.\n\nAdditional evidence from ~/mage-bench-logs/game_20260210_170138/:\n- Gem2.5Flash hit loop detection on turn 42 with 29 interactions. The warning repeated every second for 11 seconds (18:06:25-18:06:38) with the turn number stuck at 42.\n- Game hung and eventually ended via observer window close (match time limit) after 64 minutes on turn 12.",
  "status": "open",
  "priority": 1,
  "type": "task",
  "labels": ["headless-client"],
  "created_at": "2026-02-10T12:00:00.000000-08:00",
  "updated_at": "2026-02-10T18:30:00.000000-08:00"
}
