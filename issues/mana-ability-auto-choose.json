{
  "title": "GAME_CHOOSE_ABILITY during mana payment confuses LLMs — should auto-handle",
  "description": "When auto-tap taps a dual/filter land (e.g. Cascade Bluffs), XMage sends GAME_CHOOSE_ABILITY asking which mana ability to activate. LLMs consistently misunderstand this as an optional ability activation and send `answer: false` to decline, causing \"Integer 'index' required for GAME_CHOOSE_ABILITY\" errors. The model then retries with an index but without calling get_action_choices first, causing a second error.\n\nThis happened 4 times for Haiku ESPN in a single game, always during mana payment for dual lands. The pattern is always:\n1. Model sees GAME_CHOOSE_ABILITY with mana ability options\n2. Model sends `choose_action(answer=false)` — error\n3. Model sends `choose_action(index=N)` without get_action_choices — error\n4. Model finally calls get_action_choices then choose_action(index=N) — succeeds\n\nThree wasted round-trips per occurrence.\n\nEvidence:\n- ~/mage-bench-logs/game_20260211_002821/Haiku ESPN_errors.log: 4x \"Integer 'index' required for GAME_CHOOSE_ABILITY\" at 00:31:11, 01:00:54, 01:02:10, 01:25:47\n- ~/mage-bench-logs/game_20260211_002821/Haiku ESPN_pilot.log line 221-226: Model reasoning shows it thinks this is an optional ability activation\n\nSource: BridgeCallbackHandler.java:2583 `case GAME_CHOOSE_ABILITY` in storePendingAction\n\nSuggested fix: Auto-handle GAME_CHOOSE_ABILITY when it fires during mana payment (the auto-tapper context). The MCP layer already auto-handles mana payment via `handleGamePlayManaAuto`; extend this to also auto-select the mana ability that matches what's needed. When there's only one ability choice, always auto-select it. When there are multiple, pick the one producing mana matching the remaining payment cost. This would eliminate the most common source of GAME_CHOOSE_ABILITY errors without any LLM interaction.",
  "status": "open",
  "priority": 2,
  "type": "bug",
  "labels": ["headless-client"],
  "created_at": "2026-02-11T07:53:00.000000-08:00",
  "updated_at": "2026-02-11T07:53:00.000000-08:00"
}
